## ams_version=1.0

Model Main_684LocationIQ {
	Section Quantities_and_Units {
		Comment: {
			"This section contains all the units and quantities that are added automatically by AIMMS.
			It is recommended to declare all your quantities here."
		}
		Quantity SI_Time_Duration {
			BaseUnit: s;
			Conversions: minute->s : #-># * 60;
			Comment: "Expresses the value for the duration of periods.";
		}
	}
	StringParameter sp_address {
		InitialData: "<Please replace by the address you want GPS coords of>";
	}
	StringParameter sp_addressNorm;
	Parameter p_adr_lat;
	Parameter p_adr_lon;
	StringParameter sp_message;
	Parameter p_returnCode;
	Section app_start_stop {
		Procedure MainInitialization {
			Body: {
				ProfilerStart();
			}
			Comment: "Add initialization statements here that do NOT require any library being initialized already.";
		}
		Procedure PostMainInitialization {
			Body: {
				dex::ReadAllMappings();
				webui::IdentifierElementText(IndexIdentifiers) :=$ data {
					'sp_address' : "Address",
					'p_adr_lat'  : "Latitude",
					'p_adr_lon'  : "Longitude",
					'sp_message' : "Error message"
				} ;
			}
			Comment: {
				"Add initialization statements here that require that the libraries are already initialized properly,
				or add statements that require the Data Management module to be initialized."
			}
		}
		Procedure PreMainTermination {
			Body: {
				return 1;
			}
			Comment: {
				"Add termination statements here that require all libraries to be still alive.
				Return 1 if you allow the termination sequence to continue.
				Return 0 if you want to cancel the termination sequence."
			}
		}
		Procedure MainTermination {
			Body: {
				return 1;
			}
			Comment: {
				"Add termination statements here that do not require all libraries to be still alive.
				Return 1 to allow the termination sequence to continue.
				Return 0 if you want to cancel the termination sequence.
				It is recommended to only use the procedure PreMainTermination to cancel the termination sequence and let this procedure always return 1."
			}
		}
	}
	Section UI {
		StringParameter sp_Workflow {
			IndexDomain: (webui::indexWorkflowOrder,webui::indexWorkflowSpec);
			Definition: {
				{
					( '1',  'title' ) : "Workflow"
				}
			}
		}
		StringParameter sp_workflowSteps {
			IndexDomain: (webui::indexWorkflowOrder,webui::indexNoOfPages,webui::indexWorkflowPageSpec);
			Definition: {
				{
					( '1', '1', 'displayText'       ) : "Welcome",
					( '1', '1', 'icon'              ) : "aimms-home2",
					( '1', '1', 'pageId'            ) : "home",
					( '1', '1', 'tooltip'           ) : "Welcome",
					( '1', '1', 'workflowPageState' ) : "Active",
					( '1', '1', 'pageDataState'     ) : "",
					( '1', '1', 'redirectPageId'    ) : "",
				
					( '1', '2', 'displayText'       ) : "Get Access Token", 
					( '1', '2', 'icon'              ) : "aimms-lock2", 
					( '1', '2', 'pageId'            ) : "liq::access_token", 
					( '1', '2', 'tooltip'           ) : "Get your access key", 
					( '1', '2', 'workflowPageState' ) : "Active",
					( '1', '2', 'pageDataState'     ) : "", 
					( '1', '2', 'redirectPageId'    ) : "home", 
				
					( '1', '3', 'displayText'       ) : "Get GPS Coords", 
					( '1', '3', 'icon'              ) : "aimms-location", 
					( '1', '3', 'pageId'            ) : "get_coords", 
					( '1', '3', 'tooltip'           ) : "", 
					( '1', '3', 'workflowPageState' ) : if liq::sp_default_access_token <> liq::sp_accessToken then "Active" else "Inactive" endif,  
					( '1', '3', 'pageDataState'     ) : "", 
					( '1', '3', 'redirectPageId'    ) : "home"
				}
			}
		}
		StringParameter sp_secondaryActionsGetCoordsPage {
			IndexDomain: (webui::indexPageExtension,webui::indexPageActionSpec);
			Definition: {
				{
					( '1', 'displaytext' ) : "Geocode",  
					( '1', 'icon'        ) : "aimms-location2",  
					( '1', 'procedure'   ) : "MainExecution",  
					( '1', 'state'       ) : "Active"
				}
			}
		}
	}
	Procedure MainExecution {
		Body: {
			CurrentErrorMessage := "" ;
			p_returnCode := liq::pr_GeoFindCoordinates(
						address   :  sp_address, 
						latitude  :  p_adr_lat , 
						longitude :  p_adr_lon);
			sp_message :=  CurrentErrorMessage ;
			display sp_address, p_adr_lat, p_adr_lon, p_returnCode, sp_message ;
		}
	}
}
